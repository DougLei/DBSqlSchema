{
	"id":"id1",
	"type":"procedure",
	"description":"",
	"content":{
		"procedureName":"procinsertSCM_PURCHASEDELIVER",
		"isCover":true,
		"isTransaction":true,
		"parameters":[
			{
				"name":"Ids",
				"dataType":"varchar",
				"length":2500
			},
			{
				"name":"purchasedeptid",
				"dataType":"varchar",
				"length":50
			},
			{
				"name":"purchasemanid",
				"dataType":"varchar",
				"length":50
			},
			{
				"name":"Message",
				"dataType":"varchar",
				"inOut":"out"
			}
		],
		"declares":[
			{
				"name":"tempTable",
				"dataType":"tmp_table",
				"custom":{
					"typeName":"mytmptable",
					"isCreateType":true,			
					"column":[
						{
							"name":"ID",
							"dataType":"varchar",
							"length":50
						},
						{
							"name":"R",
							"dataType":"integer",
							"length":50
						}
					]
				}
			},
			{
				"name":"DELIVERCODE",
				"dataType":"varchar",
				"length":50
			},
			{
				"name":"PURCHASEID",
				"dataType":"varchar",
				"length":50
			},
			{
				"name":"R",
				"dataType":"integer"
			},
			{
				"name":"NUM",
				"dataType":"integer"
			}
		],

		"step1":{
			"id":"step1",
			"type":"sql",
			"content":[
				{
					"sqlJson":{
						"type": "insert",
						"content": {
							"paramName":"tempTable",
							"column": [
								"ID","R"
							],
							"values": {
								"type": "sub_query",
								"sqlJson":{
									"type":"select",
									"content":{
										"resultSet":[
											{
												"columnName":"T.value"
											},
											{
												"function":{
													"name":"_rownumberover",
													"orderBy":[
														{
															"columnName":"T.value",
															"sort":"asc"
														}
													]
												},
												"alias":"R"
											}
										],
										"table":{
											"type":"function",
											"alias":"T",
											"function":{
												"name":"F_Split",
												"parameters":[
													{
														"type":"parameter",
														"paramName":"Ids"
													},
													{
														"type":"value",
														"value":"','"
													}
												]
											}
										},
										"join":[
											{
												"type":"left",
												"tableType":"table",
												"alias":"R",
												"on":[
													{
														"onGroup":[
															{
																"columnName":"T.value",
																"operator":"eq",
																"value":{
																	"type":"value",
																	"values":[
																		{
																			"type":"value",
																			"value":"R.ID"
																		}
																	]
																}
															}
														]
													}
												]
											}
										]
									}
								}
							}
						}
					}
				}
			]
		},
		"step2":{
			"type":"if_else",
			"if1":{
				"isExistsCondition":{
					"isInversion":false,
					"sqlId":"",
					"sqlJson":{

					}
				},
				"condition":[
					{
						"conditionGroup":[
							{
								"leftType":"function",
								"leftFunction":{
									"name":"count",
									"parameters":[
										{
											"type":"parameter",
											"paramName":"MATERIALNAME"
										}
									]
								},
								"operator":"gt",
								"rightType":"value",
								"rightValue":"0"
							}
						]
					}
				],
				"content":[
					{
						"stepJson":{
							"id":"x1",
							"type":"set_value",
							"content":[
								{
									"parameters":[
										{
											"isDeclare":false,
											"name":"Message"
										}
									],
									"type":"function",
									"function":{
										"name":"_append",
										"parameters":[
											{
												"type":"value",
												"value":"'error:'"
											},
											{
												"type":"parameter",
												"paramName":"MATERIALNAME"
											},
											{
												"type":"value",
												"value":"'在启用中，无法删除'"
											}
										]
									}
								}
							]
						}
					}
				]
			},
			"if2":{
				"content":[
					{
						"stepJson":{
							"type":"set_value",
							"content":[
								{
									"parameters":[
										{
											"isDeclare":false,
											"name":"Message"
										}
									],
									"type":"value",
									"value":"'success:删除成功'"
								}
							]
						}
					},
					{
						"stepJson":{
							"type":"sql",
							"content":[
								{
									"sqlJson":{
										"type": "delete",
										"content": {
											"tableName": "MDM_MATERIALINFO",
											"where":[
												{
													"whereGroup":[
														{
															"columnName":"ID",
															"operator":"in",
															"value":{
																"type":"sub_query",
																"sqlId":"selectIdFromTemplate"
															}
														}
													]
												}
											]
										}
									}
								}
							]
						}
					}
				]
			}		
		},




		"stepx":{
			"type":"set_value",
			"content":[
				{
					"parameters":[
						{
							"isDeclare":false,
							"name":"MATERIALNAME"
						}
					],
					"type":"select_sql",
					"sqlJson":{
						"id":"id4",
						"type":"select",
						"content":{
							"resultSet":[
								{
									"function":{
										"name":"STUFF",
										"parameters":[
											{
												"type":"function",
												"function":{
													"name":"_forxmlpath",
													"rootNodeName":"''",
													"sqlJson":{
														"id":"id5",
														"type":"select",
														"content":{
															"resultSet":[
																{
																	"function":{
																		"name":"_append",
																		"parameters":[
																			{
																				"type":"value",
																				"value":"','"
																			},
																			{
																				"type":"value",
																				"value":"MATERIALNAME"
																			}
																		]
																	}
																}
															],
															"table":{
																"type":"table",
																"name":"MDM_MATERIALINFO",
																"alias":"t"
															},
															"where":[
																{
																	"whereGroup":[
																		{
																			"columnName":"ENABLED",
																			"operator":"eq",
																			"value":{
																				"type":"value",
																				"values":[
																					{
																						"type":"value",
																						"value":"1"
																					}
																				]
																			},
																			"nextLogicOperator":"and"
																		},
																		{
																			"columnName":"ID",
																			"operator":"in",
																			"value":{
																				"type":"sub_query",
																				"sqlJson":{
																					"id":"selectIdFromTemplate",
																					"type":"select",
																					"content":{
																						"resultSet":[
																							{
																								"columnName":"ID"
																							}
																						],
																						"table":{
																							"type":"parameter",
																							"paramName":"tempTable"
																						}
																					}
																				}
																			}
																		}
																	]
																}
															]
														}
													}
												}
											},
											{
												"type":"value",
												"value":"1"
											},
											{
												"type":"value",
												"value":"1"
											},
											{
												"type":"value",
												"value":"''"
											}
										]
									}
								}
							]
						}
					}
				}
			]
		},
		"step3":{
			"id":"step3",
			"type":"if_else",
			"if1":{
				"condition":[
					{
						"conditionGroup":[
							{
								"leftType":"function",
								"leftFunction":{
									"name":"count",
									"parameters":[
										{
											"type":"parameter",
											"paramName":"MATERIALNAME"
										}
									]
								},
								"operator":"gt",
								"rightType":"value",
								"rightValue":"0"
							}
						]
					}
				],
				"content":[
					{
						"stepJson":{
							"id":"x1",
							"type":"set_value",
							"content":[
								{
									"parameters":[
										{
											"isDeclare":false,
											"name":"Message"
										}
									],
									"type":"function",
									"function":{
										"name":"_append",
										"parameters":[
											{
												"type":"value",
												"value":"'error:'"
											},
											{
												"type":"parameter",
												"paramName":"MATERIALNAME"
											},
											{
												"type":"value",
												"value":"'在启用中，无法删除'"
											}
										]
									}
								}
							]
						}
					}
				]
			},
			"if2":{
				"content":[
					{
						"stepJson":{
							"type":"set_value",
							"content":[
								{
									"parameters":[
										{
											"isDeclare":false,
											"name":"Message"
										}
									],
									"type":"value",
									"value":"'success:删除成功'"
								}
							]
						}
					},
					{
						"stepJson":{
							"type":"sql",
							"content":[
								{
									"sqlJson":{
										"type": "delete",
										"content": {
											"tableName": "MDM_MATERIALINFO",
											"where":[
												{
													"whereGroup":[
														{
															"columnName":"ID",
															"operator":"in",
															"value":{
																"type":"sub_query",
																"sqlId":"selectIdFromTemplate"
															}
														}
													]
												}
											]
										}
									}
								}
							]
						}
					}
				]
			}		
		}
	}
}